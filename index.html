<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>HTML5 API</title>
  </head>
  <body>
  <section id="main">
    保存するKey：<input id="textkey" type="text" />
    保存する値：<input id="textdata" type="text" />
    <button id="button" onclick="setsessionStorage()">保存</button>
    <button id="button" onclick="removeStorage()">削除</button>
    <button id="button" onclick="removeallStorage()">全て削除</button>
    <table border="1">
      <tr>
        <th>キー</th><th>値</th>
      </tr>
      <tbody id="list">
      </tbody>
    </table>
  </section>
  <section id="file">
		<h3>ドラッグアンドドロップで1つから複数のファイルのプロパティを取得します。</h3>
		<div id="drop" style="width:700px; height:150px; padding:10px; border:3px solid"
                  ondragover="onDragOver(event)" ></div>
		<p>ファイルプロパティ表示</p>
		<div id="disp" ></div>
  </section>

  <script type="text/javascript">
    if (typeof sessionStorage === 'undefined') {
      window.alert("この環境ではWeb Storageが使えません");
    } else {
      var storage = sessionStorage;
      // sessionStorageへの格納
      function setsessionStorage() {
        var key = document.getElementById("textkey").value;
        var value = document.getElementById("textdata").value;
        // 値の入力チェック
        if (key && value) {
          storage.setItem(key, value);
        }
        key = "";
        value = "";
        viewStorage();
      }
      // sessionStorageからのデータの取得と表示
      function viewStorage() {
        var list = document.getElementById("list")
        while (list.firstChild) list.removeChild(list.firstChild);
        // sessionStorageすべての情報の取得
        for (var i=0; i < storage.length; i++) {
          var _key = storage.key(i);
          // sessionStorageのキーと値を表示
          var tr = document.createElement("tr");
          var td1 = document.createElement("td");
          var td2 = document.createElement("td");
          list.appendChild(tr);
          tr.appendChild(td1);
          tr.appendChild(td2);
          td1.innerHTML = _key;
          td2.innerHTML = storage.getItem(_key);
        }
      }
      // sessionStorageから削除
      function removeStorage() {
        var key = document.getElementById("textkey").value;
        storage.removeItem(key);
        key = "";
        viewStorage();
      }
      // sessionStorageからすべて削除
      function removeallStorage() {
        storage.clear();
        viewStorage();
      }
    }
    
    if (!window.File) {
      window.alert("本ブラウザではFile APIが使えません");
    } else {
      document.getElementById("drop").addEventListener("drop", onDrop, false);
	    // Drop領域にドロップした際のファイルのプロパティ情報読み取り処理
	    function onDrop(event) {
        var files = event.dataTransfer.files;
        var disp = document.getElementById("disp");
	      disp.innerHTML = "";
	      for (var i = 0; i < files.length; i++) {
          var f = files[i];
	        // ファイル名とサイズを表示
	        disp.innerHTML += "ファイル名 :" + f.name + "ファイルの型:" + f.type + "ファイルサイズ:" + f.size / 1000 + " KB " + "<br />";
		    }
		    event.preventDefault();
		  }
		  function onDragOver(event) {
		    event.preventDefault();
	   }
    }
  </script>

  </body>
</html>
